//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Danut Popa on 02.05.2025.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 16965,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1270,
     "total_market_cap": {
       "btc": 32195761.29853865,
       "eth": 1708856020.4416037,
       "ltc": 35167912209.77633,
       "bch": 8439864320.189833,
       "bnb": 5205258660.524282,
       "eos": 4197395394963.081,
       "xrp": 1408868187271.6584,
       "xlm": 11303412586261.152,
       "link": 212331338269.39948,
       "dot": 740489869995.3156,
       "yfi": 548601016.0629153,
       "usd": 3116547812995.3125,
       "aed": 11447158030827.105,
       "ars": 3654931587934904,
       "aud": 4839618534748.535,
       "bdt": 379911616368214.1,
       "bhd": 1174689201674.1929,
       "bmd": 3116547812995.3125,
       "brl": 17844452094893.207,
       "cad": 4305208498515.163,
       "chf": 2563865456934.35,
       "clp": 2955484622019715,
       "cny": 22735216295800.805,
       "czk": 68467289309398.984,
       "dkk": 20491364201400.44,
       "eur": 2746211552924.8926,
       "gbp": 2341964136101.271,
       "gel": 8554923746672.133,
       "hkd": 24156221853875.086,
       "huf": 1110003824436577,
       "idr": 51206858699624290,
       "ils": 11244155455932.03,
       "inr": 263308928199225.78,
       "jpy": 450600871285183.6,
       "krw": 4364913666629639.5,
       "kwd": 955689386855.0123,
       "lkr": 936007277924925.8,
       "mmk": 6538517311664163,
       "mxn": 61294305193965.24,
       "myr": 13307659161489.984,
       "ngn": 5005580938886160,
       "nok": 32341510563734.715,
       "nzd": 5246119215640.949,
       "php": 172803220354055.47,
       "pkr": 878552572102761.9,
       "pln": 11743794168215.816,
       "rub": 257122132007544.97,
       "sar": 11687827202590.043,
       "sek": 30093482295264.94,
       "sgd": 4035882669611.734,
       "thb": 103034635204627.16,
       "try": 120142550438327.34,
       "twd": 94711894270023.17,
       "uah": 129679308291457.73,
       "vef": 312059932515.22064,
       "vnd": 81045825876943100,
       "zar": 57396875160945.83,
       "xdr": 2244469170867.3384,
       "xag": 95962870329.06387,
       "xau": 954785587.9892437,
       "bits": 32195761298538.652,
       "sats": 3219576129853865
     },
     "total_volume": {
       "btc": 931459.3298986804,
       "eth": 49439113.0849299,
       "ltc": 1017446974.9948335,
       "bch": 244174700.2415696,
       "bnb": 150593946.16959473,
       "eos": 121435336336.9475,
       "xrp": 40760130051.38016,
       "xlm": 327020349527.96765,
       "link": 6142982743.193649,
       "dot": 21423198902.08356,
       "yfi": 15871640.06048499,
       "usd": 90165208723.34753,
       "aed": 331179065771.0735,
       "ars": 105741252587740.19,
       "aud": 140015568991.89447,
       "bdt": 10991267338633.28,
       "bhd": 33985070472.004143,
       "bmd": 90165208723.34753,
       "brl": 516259927404.56696,
       "cad": 124554489826.05843,
       "chf": 74175490938.76653,
       "clp": 85505470736524.92,
       "cny": 657755197636.8202,
       "czk": 1980835142513.203,
       "dkk": 592838050660.1844,
       "eur": 79450967135.96086,
       "gbp": 67755637912.45547,
       "gel": 247503497945.58896,
       "hkd": 698866475380.2742,
       "huf": 32113650269285.473,
       "idr": 1481471608895715.2,
       "ils": 325305974570.4608,
       "inr": 7617821350536.69,
       "jpy": 13036386427616.775,
       "krw": 126281827017054.5,
       "kwd": 27649161255.01451,
       "lkr": 27079735863112.273,
       "mmk": 189166607901583.03,
       "mxn": 1773312701419.7207,
       "myr": 385005441248.6939,
       "ngn": 144817046686830.12,
       "nok": 935676018910.439,
       "nzd": 151776087661.30676,
       "php": 4999390147753.033,
       "pkr": 25417507059500.547,
       "pln": 339761080502.5705,
       "rub": 7438830427430.787,
       "sar": 338141893684.3165,
       "sek": 870638050554.1141,
       "sgd": 116762592818.60417,
       "thb": 2980907063328.6484,
       "try": 3475858156790.417,
       "twd": 2740120873432.9487,
       "uah": 3751767211927.0015,
       "vef": 9028242349.468788,
       "vnd": 2344746252850652.5,
       "zar": 1660555697998.6514,
       "xdr": 64934999687.962975,
       "xag": 2776313007.8840833,
       "xau": 27623013.34448474,
       "bits": 931459329898.6804,
       "sats": 93145932989868.05
     },
     "market_cap_percentage": {
       "btc": 61.6819332702078,
       "eth": 7.063829403532959,
       "usdt": 4.779540607878876,
       "xrp": 4.152138547256109,
       "bnb": 2.8024015156199606,
       "sol": 2.4891272181591235,
       "usdc": 1.97169487913572,
       "doge": 0.8624252079834429,
       "ada": 0.8165129943927765,
       "trx": 0.7460478579808888
     },
     "market_cap_change_percentage_24h_usd": -1.0173995239483797,
     "updated_at": 1746180591
   }
 }
 
 
 */

import Foundation

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap["eur"] {
            return "€" + item.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume["eur"] {
            return "€" + item.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage["btc"] {
            return item.asCurrencyWithDecimals(2, numberStyle: .percent)
        }
        return ""
    }
}
